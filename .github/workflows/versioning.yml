name: versioning

on:
  push:
    branches: [ main ]

jobs:
  release:
    name: "Release"
    runs-on: ubuntu-latest

    steps:
      - name: Ð¡heckout Repo
        uses: actions/checkout@main
        with:
          fetch-depth: 0
      
      - name: Get commit data
        id: newtag
        env:
          COMMIT_TEXT: ${{ github.event.head_commit.message }}
        run: |
            echo "TAG_NAME=`echo '${{ env.COMMIT_TEXT }}' | grep -o 'TAG: [a-zA-Z0-9]*' | cut -d' ' -f2 `" >> $GITHUB_OUTPUT
            echo "RELEASE_NAME=`echo '${{ env.COMMIT_TEXT }}' | head -n 1`" >> $GITHUB_OUTPUT
            
      - name: Check vars
        run: |
            echo ${{ steps.newtag.outputs.TAG_NAME }}
            echo ${{ steps.newtag.outputs.RELEASE_NAME }}

      - uses: CupOfTea696/gh-action-auto-release@v1.0.0
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          title: ${{ steps.newtag.outputs.RELEASE_NAME }}
          tag: ${{ steps.newtag.outputs.TAG_NAME }}
          changelog-entry: ${{ steps.newtag.outputs.TAG_NAME }}
          regex: "/^Release #{semver}$/i"
        
      # - name: "Build Firmaware"
      #   run: make build
        
      # - name: "Rename Firmware"
      #   run: cp output/*.uf2 ${{ github.event.repository.name }}_${{ steps.newtag.outputs.TAG_NAME }}.uf2

      # - name: "Build & test"
      #   run: |
      #     echo "done!"
          
      # - uses: "marvinpinto/action-automatic-releases@latest"
      #   with:
      #     repo_token: "${{ secrets.GITHUB_TOKEN }}"
      #     automatic_release_tag: "${{ steps.newtag.outputs.TAG_NAME }}"
      #     prerelease: true
      #     files: |
      #       *.uf2
